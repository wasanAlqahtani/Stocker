{% extends 'main/base.html' %}
{% block title %}
categories Page
{% endblock %}

{% block content %}
     {% if messages %}
        {% for message in messages %}
          <div class="alert alert-success">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
  <!-- Add Category Button and form  -->
{% if perms.main.add_category%}
<div class="d-flex justify-content-between align-items-center mb-3">
    <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
  Add Category
</button>
</div>
{%endif%}
<p> Total Number Of Category: {{categories.count}}</p>
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" action="{% url 'main:add_category_view' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">Add Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">{{ category_form.category_name.label}}</label>
            {{ category_form.category_name }}
          </div>

          <div class="mb-3">
            <label class="form-label">{{ category_form.description.label }}</label>
            {{ category_form.description }}
          </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-outline-secondary btn-sm">Add Category</button>
        </div>
        </div>
      </form>
    </div>
  </div>
</div>
  <!-- Table to dicplay the categories with its detail when press the name  -->
<table class="table table-striped align-middle">
  <thead class="table-light">
    <tr>
      <th scope="col">Number</th>
      <th scope="col">Category Name</th>
      <th scope="col">Total Products</th>
      {% if request.user.is_superuser%}
      <th scope="col"> Edit & Delete</th>
      {%endif%}
    </tr>
  </thead>
  <tbody>
    {% for category in categories %}
    <tr>
      <th scope="row">{{ forloop.counter }}</th>

      <td>
        <a href="#" class="fw-bold text-decoration-none" data-bs-toggle="modal" data-bs-target="#categoryModal{{ category.id }}">
            {{ category.category_name }}
        </a>
          <div class="modal fade" id="categoryModal{{ category.id }}" tabindex="-1" aria-labelledby="categoryModalLabel{{ category.id }}" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="categoryModalLabel{{ category.id }}">
            {{ category.category_name }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <p><strong>Description:</strong></p>
          <p>{{ category.description }}</p>

          <p><strong>Created at:</strong></p>
          <p>{{ category.created_at }}</p>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>
      </td>
      <td>{{ category.total_products }}</td>
        <!-- Edit Category  -->
      {% if perms.main.change_category%}
      <td>
        <a href="#" class="text-warning me-2" data-bs-toggle="modal" data-bs-target="#updateCategoryModal{{ category.id }}">
        <i class="bi bi-pencil-square"></i>
        </a>
        <div class="modal fade" id="updateCategoryModal{{ category.id }}" tabindex="-1" aria-labelledby="updateCategoryModalLabel{{ category.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" action="{% url 'main:update_category_view' category.id %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="updateCategoryModalLabel{{ category.id }}">Update Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Category Name</label>
            <input type="text" name="category_name" class="form-control" value="{{ category.category_name }}">
          </div>

          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control">{{ category.description }}</textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-outline-secondary btn-sm">Update Category</button>
        </div>
      </form>
    </div>
  </div>
</div>
  <!-- Delete Category  -->
{% if perms.main.delete_category%}
        <a href="{% url 'main:delete_category_view' category.id %}" class="text-danger" onclick="return confirm('Are you sure you want to delete this Category?')">
          <i class="bi bi-trash3"></i>
        </a>
        {%endif%}
      </td>
      {%endif%}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
